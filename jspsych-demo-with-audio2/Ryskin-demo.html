<!DOCTYPE html>
<html>

<head>
  <title>Ryskin demo</title>
  <script src="jspsych-6.3.1/jspsych.js"></script>
  <script src="js/webgazer.js"></script>
  <script src="jspsych-6.3.1/plugins/jspsych-preload.js"></script>
  <script src="jspsych-6.3.1/plugins/jspsych-fullscreen.js"></script>
  <script src="jspsych-6.3.1/plugins/jspsych-html-button-response.js"></script>
  <script src="jspsych-6.3.1/plugins/jspsych-webgazer-init-camera.js"></script>
  <script src="jspsych-6.3.1/plugins/jspsych-webgazer-calibrate.js"></script>
  <script src="jspsych-6.3.1/plugins/jspsych-webgazer-validate.js"></script>
  <script src="jspsych-6.3.1/extensions/jspsych-ext-webgazer.js"></script>
  <script src="eye-track-image-sort.js"></script>
  <script src="calibration-config.js"></script>
  <script src="initial-calibration-timeline.js"></script>
  <script src="calibration-booster-timeline.js"></script>
  <link rel="stylesheet" href="jspsych-6.3.1/css/jspsych.css">
  <style>
    .jspsych-content {
      max-width: 100%;
    }
  </style>
</head>

<body></body>
<script>

  var timeline = [];

  //timeline.push(initial_calibration_timeline);
  //timeline.push(calibration_booster_timeline);

  var preload = {
    type: 'preload',
    audio: ['Audio/Audio/Critical_trials/strike_the_elephant_with_the_umbrella.mp3'],
    on_success: function (file) {
      console.log('File loaded: ', file);
    },
    on_error: function (file) {
      console.log('Error loading file: ', file);
    }
  };

  timeline.push(preload);


  var welcome = {
    type: "html-button-response",
    stimulus: '<p>Welcome to the experiment.</p>' +
      '<p>You will be presented with four objects</p>' +
      '<p>Listen to the audio prompt and use your mouse to click and drag the objects</p>',
    choices: ['Continue'],
    margin_vertical: '20px'
  };

  timeline.push(welcome);



  var trials1 = [
    {audio: 'Audio/Audio/Critical_trials/strike_the_elephant_with_the_umbrella.mp3', images: ['img/elephant_umbrella.png','img/fan.png','img/umbrella.png','img/pencil.png']},
    {audio: 'Audio/Audio/Critical_trials/bop_the_elephant_with_the_napkin.mp3', images: ['img/elephant_napkin.png','img/fan.png','img/napkin.png','img/pencil.png']}
  ]

  var trials2 = [
    {verb_type: 'modified', compatibility_type: 'instrument', audio: 'Audio/Audio/Critical_trials/strike_the_elephant_with_the_umbrella.mp3', images: ['img/elephant_umbrella.png','img/fan.png','img/umbrella.png','img/pencil.png']},
    {audio: 'Audio/Audio/Critical_trials/bop_the_elephant_with_the_napkin.mp3', images: ['img/elephant_napkin.png','img/fan.png','img/napkin.png','img/pencil.png']}
  ]

  var which_list = jsPsych.randomization.sampleWithoutReplacement(["list_1", "list_2"], 1)[0];
  if(which_list == 'list_1'){
    var trials = trials1;
  } else {
    var trials = trials2;
  }

  jsPsych.data.addProperties({
    which_list: which_list
  })

  var sort_trial = {
    type: 'eye-track-image-sort',
    images: jsPsych.timelineVariable('images'),
    image_width: 200,
    image_height: 200,
    audio: jsPsych.timelineVariable('audio'),
    data: {
      verb: jsPsych.timelineVariable('verb_type'),
      compatibility: jsPsych.timelineVariable('compatibility_type')
    }
  };

  var test_trials = {
    timeline: [sort_trial],
    timeline_variables: trials,
    randomize_order: true
  }

  timeline.push(test_trials);

  jsPsych.init({
    timeline: timeline,
    extensions: [
      { type: 'webgazer' }
    ]
  })

</script>

</html>